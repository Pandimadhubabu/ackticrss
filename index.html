<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=no">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
    <link rel="icon" type="image/png" href="favicon/favicon.png">
    <script src="https://acktic.github.io/rss.js"></script>
  </head>
<style>
@media only screen and (min-width: 960px) {
    html {
	background-color: rgba(38,38,38,.02);
    }
    body {
	transform: translate(50%,50%);
    	position: fixed;
	border: none;
	bottom: 49%;
	height: 95%;
	width: 45%;
	right: 50%;
	border: 1px solid #ddd;
    }
}
    ::-webkit-scrollbar { display: none }
    .cat:hover { color: #AAA }
    div { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif }
    .con {
	position: absolute;
	height: 99%;
	width: 100%;
	left: 0em;
	top: .1em;
    }
    .cat {
	display: inline-block;
	text-align: center;
	font-size: 12px;
	padding-top: .4em;
	cursor: pointer;
	height: 2.5em;
	width: 16.3%;
    }
    .out {
	-ms-overflow-style: -ms-autohiding-scrollbar;	
	outline: none !important;
	scrollbar-width: none;
	padding-left: 1em;
	overflow: auto;
	height: 88%;
    }
    .set {
	padding-bottom: 2em;
	line-height: 1.4em;
	margin-left: 17%;
	font-size: 13px;
	cursor: default;
	height: 5em;
	width: 70%;
    }
    .clr {
	border-radius: 16px;
	width: fit-content;
	line-height: 1.6em;
	margin-bottom: 3em;
	margin-right: 1em;
	margin-left: auto;
	font-size: 13px;
	cursor: pointer;
	display: table;
	padding: 1.5em;
    }
    .ago {
	line-height: 1.2em;
	text-align: right;
	font-size: 9px;
    }
    .favicon {
	transform: translate(50%,50%);
	position: fixed;
	bottom: 1.55em;
	width: 50%;
	right: 50%;
    }
    .inv, .fav {
	border-radius: 24px;
	height: 40px;
	width: 40px;
    }
</style>
<body>
    <div class="con">
	<div class="tag" style="justify-content:center;display:flex;height:1.7em;z-index:1;">
		<div id="News" class="cat">News</div>
		<div id="Media" class="cat">Media</div>
		<div id="Social" class="cat">Social</div>
		<div id="Sport" class="cat">Sport</div>
		<div id="Technology" class="cat">Tech</div>
		<div id="World" class="cat">World</div>
	</div>
	<div class="out"></div>
	<div class="favicon" style="display:flex;justify-content:center">
		<img class="inv" src="favicon/invert.png">
		<img class="fav" src="favicon/favicon.png">
	</div>
    </div>
<script>
var ost = 0
var old = null
var opp = false
var tap = false
var rss = false
var sel = 'Social'
    if (location.href.match('\\?opp=0')) app(false)
    else if (location.href.match('\\?opp=1')) app(true)
    if (   location.href.match('\\&category=News') 
	|| location.href.match('\\&category=Media')
	|| location.href.match('\\&category=Social')
	|| location.href.match('\\&category=Sport')
	|| location.href.match('\\&category=Technology')
	|| location.href.match('\\&category=World'))
	pop(location.search.split('&category=')[1])
    else { pop(sel); app(opp) }
$('.out').attr('tabindex',-1).focus();
$('.out').focusout(function(){ setTimeout(function(){ $('.out').focus() }, 100) })
$('.cat').on('touchstart click', function(e){ $('.cat').css('color','#373737'); $(this).css('color','#AAA'); pop($(this).attr('id')) })
$('.out').bind('scroll', function(e){ if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) if (rss == false) pop(sel); tag($(this).scrollTop()) })
$('.inv, .fav').on('touchstart click', function(e){ if (!tap){ tap = setTimeout(function(){ tap = null; pop(sel) }, 250) } else { clearTimeout(tap); tap = null; app('opp') } e.preventDefault() })
$('.cat').on('mouseenter', function() { $('.tag').animate({opacity:1},0) })
function url(n){ window.open(n) }
function xhr(n){ old = n; get(menu[n].cat, menu[n].des, menu[n].uri, menu[n].ext) }
function scr(n){ $('.out').animate({ scrollTop:$(n+':last').offset().top - $('.out').offset().top + $('.out').scrollTop()}, 300) }
function tag(n){
	if (n < ost && n != 0) $('.tag').animate({opacity:1},0)
	else if (n > ost && n > 50) $('.tag').animate({opacity:0},0)
	ost = n
}
function utc(n){
	var dmz = []
	dmz.push(ago(n))
	var utc = new Date(n)
	var opt = { weekday:'short',day:'2-digit',month:'short',year:'numeric',hour:'numeric',minute:'numeric',second:'2-digit',hour12:true }
	var gmt = utc.toLocaleString('en-US', opt);
	dmz.push(gmt)
     return dmz
}   
function ago(n){
	var dat = new Date()
	var dif=dat.getTime() - new Date(n).getTime()
	var sec=dif/1000; if(sec<60) return parseInt(sec)+' second'+(parseInt(sec)>1?'s':'')+' ago'
	var min=sec/60; if(min<60) return parseInt(min)+' minute'+(parseInt(min)>1?'s':'')+' ago';
	var h=min/60; if(h<24) return parseInt(h)+' hour'+(parseInt(h)>1?'s':'')+' ago';
	var d=h/24; if(d<30) return parseInt(d)+' day'+(parseInt(d)>1?'s':'')+' ago';
	var m=d/30; if(m<12) return parseInt(m)+' month'+(parseInt(m)>1?'s':'')+' ago';
	var y=m/121; return parseInt(y)+' year'+(parseInt(y)>1?'s':'')+' ago';
}
function app(n){
	if (n == 'opp') opp = opp != true
	else if (n == true || n == false) opp = n
	if (opp == true){
		$('html, body, .con, .out, .clr').css({'background-color':'#000','border':'none','color':'#EFEFEF'})
		$('.fav').css('display','block'); $('.inv').css('display','none')
	}
	else if (opp == false){
		$('body, .con, .out, .clr').css({'background-color':'#fff','color':'#373737'})
		$('.inv').css('display','block'); $('.fav').css('display','none')
		$('html').css('background-color','rgba(38,38,38,.02)');
	}
}
function pop(n){
	$('.pop, .bar').remove()
	if (n != sel) old = null
	var ago = []
	sel = n
	$(document).attr('title',n)
	$('.out').append("<br><div class='bar'></div><div class='pop' style='margin-right:5%'><br></div>")
	$.each(menu, function(i, k){
		if (n == k.cat){
			ago.push(i)
			$('.pop').append("<div class='set "+i+"' onclick='xhr("+i+")'><hr style='border-top:0px'>"+k.des+"</div>")
		}
	})
	$('.out').append("<div class='bar' style='padding-bottom:"+$(".out").height()*.02+"em'></div>")
	if (old!=null && ago.indexOf(old) <= ago.length  - ago.length * .25){
		scr('.'+old)
		old = null
	}
	else if (old!=null & ago.indexOf(old) >= ago.length - ago.length * .25){
		var mid = ago[Math.floor(ago.length / 1.5)]
		scr('.'+mid)
		old = null
	}
	else scr('.pop:last')
}
function get(cat, des, uri, ext){
	rss = true
	$('.bar').remove();
	$('.out').append("<div class='bar' style='text-align:center;padding-right:1em'>.</div><div class='get'></div>")
	var int = setInterval(function() { $(".bar").append(".") }, 1000);
	scr('.get:last')
	$.get('https://salty-refuge-64158.herokuapp.com/'+uri)
		.fail(function(){ $('.out').append("<div class='get'><div class='set'>&ensp;Oops! Something went wrong!</div></div>")
			clearInterval(int)
			rss = false
		})
		.success(function(req){
			clearInterval(int)
			$('.out').append("<div class='set' onclick='url(\""+ext+"\")'>"+des+"</a><hr style='border-top:0px'></div>")
			if ($(req).find('entry').length > 0) var set = "entry"
			else 				     var set = 'item'
				$(req).find(set).each(function(i, k){
					if (i >= 19) return false
					if (set == 'entry'){ var ref = $(this).find('link').attr('href')
							     var pdt = utc($(this).find('updated').text())
					}
					else {		     var ref = $(this).find('link').text()
		if ($(this).find('pubDate').text().length>0) var pdt = utc($(this).find('pubDate').text())
							else var pdt = utc($(this).find('dc\\:date, date').text())
					}
			$('.out').append("<div class='pad'><div class='clr' onclick='url(\""+ref+"\")'><a>"+$(this).find("title").text()+"...</a>" +
					 "<div class='ago'>"+pdt[0]+"<br>"+pdt[1]+"<hr style='border-top:0px'></div></div></div>")
		})
				$('.out').append("<br><div class='set' onclick='url(\""+ext+"\")'>"+des+"</a><hr style='border-top:0px'></div>" +
						 "<div class='bar' style='padding-bottom:"+$(".out").height()*.02+"em'></div>")
		scr('.get:last')
		rss = false
		app(opp)
		})
}
</script>
</body>
</html>
