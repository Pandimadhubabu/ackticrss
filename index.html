<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0,user-scalable=no" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
    <link rel="shortcut icon" type="image/ico" href="favicon.ico">
    <script src="rss.js"></script>
  </head>
<body>
<style>
	::-webkit-scrollbar { display: none; }
	.container {
		height: 100%;
		width: 100%;
		overflow: hidden;
		position: absolute;
		left: -.5px;
		top: 0px;
	}
	.output {
		position: absolute;
		bottom: 2em;
		width: 99%;
		left: 2px;
		top: 3em;
		overflow: auto;
		line-height: 1.4em;
		outline: none !important;
		scrollbar-width: none;
		background-color: transparent;
	}
	.bottom {
		position: absolute;
		font-size: 12px;
		font-family: Arial;
		bottom: 1em;
		height: 1.5em;
		width: 100%;
		text-align: center;
	}
	button {
		border: none;
		width: 16.6%;
		border: none;
		font-size: 12px;
		padding: 10px;
	}
	button.buttonOutput {
		font-size: 13px;
		font-family: Arial;
		width: 100%;
		height: 5em;
		border: none;
		text-align: left;
	}
</style>
<script>
var Proxy = "https://salty-refuge-64158.herokuapp.com/";
jQuery(function($) {
    $(window).load(function () { $("#Social").trigger("click"); $(".output").attr('tabindex', -1).focus(); $(".output").focusout(function(){ $(".output").attr('tabindex', -1).focus(); }); });
    $(document).one("ready", function () {
	$(".menu").live("click", function(event) {
		var name = $(this).get(0).id;
		$.each(menu, function(index, key) { if (name === key.name) { $(this).getfeed(key.category, key.feed, key.title, key.homepage); } });
	});
	$(".random").live("click", function () {
		var array = [];
		$.each(menu, function(index, key) { if (key.category == $(".selected").attr("id")) { array.push(menu[index].name); } });
		var name = array[Math.floor(Math.random()*array.length)];
		$.each(menu, function(index, key) {
			if (name == key.name) {
				$(this).getfeed(key.category, key.feed, key.title, key.homepage);
				return false;
			}
		});
	});
   	$('.output').bind('scroll', function(){ if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight ) { if (!$(".output").hasClass("fetch")) { $(this).showMenu(); } } });
    });
    $(".toggle").live("click", function () {
	if ($(".output").hasClass("dark")) { $(".output").removeClass("dark"); $(".output").addClass("light"); }
	else if ($(".output").hasClass("light")) { $(".output").removeClass("light"); $(".output").addClass("dark"); }
	$(this).applyColors();	
    });
    $(".category").live("click", function(event) { $(".category").removeClass("selected"); $(this).addClass("selected"); $(this).showMenu(); });
    $(".github").live("click", function () { window.open("https://github.com/acktic/acktic.github.io"); });
    $.fn.cloneRepo = function () { $(".output").append("<br><hr><br><button class='buttonOutput info'><i class='fa fa-git'>&ensp;</i>&ensp;Clone this Repository!</button><br><br>"); }
    $.fn.animateScroll = function (hr) { $(".output").animate({ scrollTop: $(hr + ":last").offset().top - $(".output").offset().top + $(".output").scrollTop() }, "slow"); }
    $.fn.showMenu = function () {
	$(".output").append("<hr class='title'>");
	$(this).animateScroll(".title");
	$.each(menu, function(index, key) {
		if ($(".selected").attr("id") == key.category) { $(".output").append("<button id='" + key.name + "' class='menu buttonOutput'><i class='fa fa-rss'>&ensp;</i>&ensp;<b>" + key.category + "</b>&ensp;" + key.title + "</button>"); }
		if (index == (menu.length - 1)) { $(this).cloneRepo(); }
	});
	$(this).applyColors();
    }
    $.fn.applyColors = function () {
	if ($(".output").hasClass("light")) {
		$("html, body, a, .category, .output, .container, button, .bottom").attr("style", "background-color: #F5F5F5; color: #000000; text-decoration: none;");
		$("button.category, button.buttonOutput, .bottom button, .info").css("background-color", "transparent");
		$(".buttonOutput").live("click", function () { $(this).css("background-color", "#EEEEEE"); });
		$(".info").css("background-color", "#EEEEEE");
	}
	else if ($(".output").hasClass("dark")) {
		$("html, body, a, .category, .output, .container, .bottom, button").attr("style", "background-color: #000000; color: #FFFFFF; text-decoration: none;");		
		$(".buttonOutput").live("click", function () { $(this).css("background-color", "#222222"); });
		$(".info").css("background-color", "#222222");
	}
	$(".selected").css("text-decoration", "underline"); $(".toggle").css("float", "left"); $(".random").css("float", "right");
    }
    $.fn.getfeed = function (category, feed, title, homepage) {
	$(".output").append("<hr class='fetch'><br><button class='buttonOutput info'>Fetching source.  Please be patient.</button><br>")
	$(".output").addClass("fetch"); $(this).animateScroll(".fetch"); $(this).applyColors();
	var jqxhr = $.get(Proxy + feed)
	.success(function (data) {
		var entry = $(data).find("entry");
		if (entry.length > 0) { var format = "entry" } else { var format = "item" }
		$(".output").append("<br><hr class='first'><button class='buttonOutput info' onclick='window.open(&quot;" + homepage + "&quot;, target=&quot;_blank&quot;)'>" +
				    "<i class='fa fa-external-link'></i>&ensp;&ensp;<b>" + category + "</b>&ensp;" + title + "</button><br>");
	        $(data).find(format).each(function (index, key) {
			if (format == "entry") { var link = $(this).find("link").attr("href"); } else { var link = $(this).find("link").text(); }
			$(".output").append("<br><button class='buttonOutput' onclick='window.open(&quot;" + link + "&quot;, target=&quot_blank&quot;)'>&ensp;&ensp;" + $(this).find("title").text() + "</button>");
   		});
		$(this).animateScroll(".first");
	})
	.fail(function () {
		$(".output").removeClass("fetch");
		$(".output").append("<br><hr><button class='buttonOutput info'>Oops!  Something went wrong.</button><br>" +
				    "<button class='buttonOutput info' onclick='window.open(&quot;" + proxy + "&quot;, target=&quot;_blank&quot;)'>You can verify the proxy here.</button>" +
				    "<button class='buttonOutput info' onclick='window.open(&quot;" + feed  + "&quot;, target=&quot;_blank&quot;)'>Also the validity of the feed here.</button>");
		$(this).applyColors();
	})
	.done(function () {
		$(".output").removeClass("fetch");
		$(".output").append("<br><button class='buttonOutput info' onclick='window.open(&quot;" + homepage + "&quot;, target=&quot;_blank&quot;)'><i class='fa fa-external-link'></i>" +
				    "&ensp;&ensp;<b>" + category + "</b>&ensp;" + title + "</button>");
		$(this).cloneRepo();
		$(this).applyColors();
	});
    }
});
</script>
<div class="container">
<div class="top"><button id="Local" class="category">Local</button><button id="Entertainment" class="category">Celeb</button><button id="Social" class="category">Social</button><button id="Sports" class="category">Sports</button><button id="Technology" class="category">Tech</button><button id="World" class="category">World</button></div>
<div class="output light"></div>
<div class="bottom"><button class="toggle" style="float:left;"><i class="fa fa-th-large"></i></button><button class="github"><i class="fa fa-git"></i></button><button class="random" style="float:right;"><i class="fa fa-random"></i></button></div>
</div>
</body>
</html>
