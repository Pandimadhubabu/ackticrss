<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=no">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link rel="icon" type="image/png" href="favicon/invert.png">
    <script src="https://acktic.github.io/rss.js"></script>
  </head>
<style>
@media only screen and (min-width: 960px) {
    html { background-color: rgba(38,38,38,.02); }
    body {
	transform: translate(50%,50%);
	border: 1px solid #ddd;
    	position: fixed;
	border: none;
	bottom: 49%;
	height: 95%;
	width: 45%;
	right: 50%;
    }
}
    hr { opacity: .2 }
    .cat:hover { color: #AAA }
    .gap { padding-bottom: 12em }
    ::-webkit-scrollbar { display: none }
    div { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif }
    .con {
	position: absolute;
	height: 100%;
	width: 100%;
	left: 0em;
	top: .1em;
    }
    .cat {
	display: inline-block;
	text-align: center;
	padding-top: .4em;
	font-size: 12px;
	cursor: pointer;
	height: 2.5em;
	width: 16.3%;
    }
    .out {
	-ms-overflow-style: -ms-autohiding-scrollbar;
	outline: none !important;
	scrollbar-width: none;
	overflow: auto;
	height: 88%;
    }
    .set {
	padding-bottom: 2em;
	line-height: 1.4em;
	margin-left: 17%;
	font-size: 13px;
	cursor: default;
	height: 5em;
	width: 70%;
    }
    .clr {
	width: fit-content;
	line-height: 1.6em;
	margin-bottom: 3em;
	text-align: right;
	margin-right: 1em;
	margin-left: auto;
	font-size: 13px;
	cursor: pointer;
	display: table;
	padding: 1.5em;
    }
    .ago {
	line-height: 1.2em;
	text-align: right;
	font-size: 9px;
	float: right;
    }
    .ico {
	transform: translate(50%,50%);
	position: fixed;
	bottom: 1.55em;
	width: 50%;
	right: 50%;
    }
    #inv, #fav {
	border-radius: 24px;
	height: 40px;
	width: 40px;
    }
</style>
<body>
<div class="con"><div class="tag" style="justify-content:center;display:flex;height:1.7em"><div id="News" class="cat">News</div><div id="Media" class="cat">Media</div><div id="Social" class="cat">Social</div><div id="Sport" class="cat">Sport</div><div id="Technology" class="cat">Tech</div><div id="World" class="cat">World</div></div><div class="out"></div><div class="ico" style="display:flex;justify-content:center"><img id="inv" class="fav" src="favicon/invert.png"><img id="fav" class="fav" src="favicon/favicon.png"></div></div>
<script>
var ost = 0		/*	.out.scrollTop			*/
var opp = 0		/*	Default(1=Dark)			*/
var old = null		/*	Old last xhr class		*/
var job = false		/*	Get failsafe to pop		*/
var tap = false		/*	Icon (1=pop) (2=app(opp))	*/
var sel = 'Social'	/*	Initial Category (!Defined)	*/
if (location.href.match('\\?opp=0') || location.href.match('\\?opp=1')) app(location.search.split('?opp=')[1])
if (location.href.match('\\&category=News') || location.href.match('\\&category=Media') || location.href.match('\\&category=Social') || location.href.match('\\&category=Sport') || location.href.match('\\&category=Technology') || location.href.match('\\&category=World')){ pop(location.search.split('&category=')[1]) } else { pop(sel); app(opp) }
$('.out').attr('tabindex',-1).focus(); $('.out').focusout(function(){ setTimeout(function(){ $('.out').focus() }, 100) })
$('.cat').on('touchstart click', function(e){ $('.cat').css('color','inherit'); $(this).css('color','#AAA'); pop($(this).attr('id')) })
$('.out').on('scroll', function(e){ if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) if (job == false) pop(sel); tag($(this).scrollTop()) })
$('.fav').on('touchstart click', function(e){ if (!tap){ tap = setTimeout(function(){ tap = null; pop(sel) }, 250) } else { clearTimeout(tap); tap = null; app('opp') } e.preventDefault() })
$('.tag').on('mouseenter', function() { $(this).animate({opacity:1},0) })
function scr(n){ $('.out').animate({ scrollTop:$(n+':last').offset().top - $('.out').offset().top + $('.out').scrollTop()}, 300) }
function tag(n){ if (n < ost && n != 0){ $('.tag').animate({opacity:1},0) } else if (n > ost && n > 50){ $('.tag').animate({opacity:0},0) } ost = n }
function utc(n){ var opt = { weekday:'short',day:'2-digit',month:'short',year:'numeric',hour:'numeric',minute:'numeric',second:'2-digit',hour12:true }; var dmz = []; dmz.push(ago(n)); var utc = new Date(n); var gmt = utc.toLocaleString('en-US', opt); dmz.push(gmt); return dmz }
function ago(n){ var age = new Date(); var dis=age.getTime() - new Date(n).getTime(); var sec=dis/1000; if(sec<60) return parseInt(sec)+' second'+(parseInt(sec)>1?'s':'')+' ago'; var min=sec/60; if(min<60) return parseInt(min)+' minute'+(parseInt(min)>1?'s':'')+' ago'; var h=min/60; if(h<24) return parseInt(h)+' hour'+(parseInt(h)>1?'s':'')+' ago'; var d=h/24; if(d<30) return parseInt(d)+' day'+(parseInt(d)>1?'s':'')+' ago'; var m=d/30; if(m<12) return parseInt(m)+' month'+(parseInt(m)>1?'s':'')+' ago'; var y=m/121; return parseInt(y)+' year'+(parseInt(y)>1?'s':'')+' ago' }
function app(n){ if (n == 'opp'){ opp = opp != true } else if (n == 1 || n == 0) opp = n
	if (opp == 1){
		$('html, body, .con, .out, .clr').css({'background-color':'#000','border':'none','color':'#EFEFEF'})
		$('#fav').css({'box-shadow':'0px 0px 0px #000','display':'block'})
		$('#inv').css('display','none')
	}
	else if (opp == 0){
		$('body, .con, .out, .clr').css({'background-color':'#fff','color':'#373737'})
		$('#inv').css({'box-shadow':'1px 1px 3px #AAA','display':'block'})
		$('html').css('background-color','rgba(38,38,38,.02)');
		$('#fav').css('display','none')
	}
}
function pop(n){
	if (n != sel) old = null
	var pre = []
	sel = n
	$(document).attr('title',n+' ack')
	$('.pop, .arm, .gap').remove()
	$('.out').append("<br><div class='pop'><br></div>")
	$.each(menu, function(i, k){ if (n == k.cat){ pre.push(i); $('.pop').append("<div class='set "+i+"' onclick='get("+i+")'><hr>"+k.des+"</div>") } })
	$('.pop').append("<div class='gap'></div>")
	if (old!=null && pre.indexOf(old) <= pre.length  - pre.length * .25){ scr('.'+old); old = null }
	else if (old!=null && pre.indexOf(old) >= pre.length - pre.length * .25){ var end = pre[Math.floor(pre.length / 1.5)]; scr('.'+end); old = null }
	else scr('.pop')
}
function get(n){
	old = n
	job = true
	$('.gap').remove();
	$('.out').append("<div class='arm' style='text-align:center'>.</div><div class='get'></div>")
	var int = setInterval(function() { $(".arm").append(".") }, 1000);
	scr('.get')
	$.get('https://salty-refuge-64158.herokuapp.com/' + menu[n].uri)
		.fail(function(){ $('.out').append("<div class='set'>&ensp;Oops! Something went wrong!</div>"); clearInterval(int); job = false })
		.done(function(xhr){ clearInterval(int)
			$('.get').append("<div class='set' onclick='window.open(\""+menu[n].ext+"\")'>"+menu[n].des+"</a><hr></div>")
			if ($(xhr).find('entry').length > 0)				     var set = "entry"
			else 								     var set = 'item'
				$(xhr).find(set).each(function(i){
					if (i >= 19) return false
					if (set == 'entry'){				     var ref = $(this).find('link').attr('href')
											     var pdt = utc($(this).find('updated').text())
					}
					else {						     var ref = $(this).find('link').text()
						if ($(this).find('pubDate').text().length>0) var pdt = utc($(this).find('pubDate').text())
											else var pdt = utc($(this).find('dc\\:date, date').text())
					}
					$('.get').append("<div class='clr' onclick='window.open(\""+ref+"\")'>"+$(this).find("title").text()+"...<br><div class='ago'><br>"+pdt[0]+"<br>"+pdt[1]+"<hr></div></div>")
				})
			$('.get').append("<br><div class='set' onclick='window.open(\""+menu[n].ext+"\")'>"+menu[n].des+"<hr></div><div class='gap'></div>")
			job = false
			scr('.get')
		})
}
</script>
</body>
</html>
