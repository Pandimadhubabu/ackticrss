<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>hiwi</title>
    <link rel="shortcut icon" href="favicon.ico">
    <script src="rssfeeds.js"></script>
    <script src="jquery-1.7.1.min.js"></script>
    <script src="jquery.mousewheel-min.js"></script>
    <script src="jquery.terminal.min.js"></script>
    <link href="jquery.terminal.min.css" rel="stylesheet"/>
  </head>
<body>
<style> @import url('https://fonts.googleapis.com/css?family=Space+Mono&display=swap');

	a { text-decoration: none; letter-spacing: .1em; }

	.cmd, span { visibility: hidden; }

	.terminal, .cmd { --size: .9; font-family: 'Space Mono', monospace; line-height:1.2em; }

	::-webkit-scrollbar { display: none; }

	#clock { cursor: pointer; position: absolute; z-index: 365; top: .65em; right: 2em; font-size: .7em; font-family: 'Space Mono', monospace; }
</style>
<script>
var proxy = "https://cors-anywhere.herokuapp.com/";

jQuery(function($) {

    $(".theme").val("yotsuba"); themeColors("yotsuba");

    $("body").terminal(function(command, term) {

	$(document).one('ready', function() { $(".menu").live("click", function(event) { term.exec(event.target.id); term.clear(); }); $(".help").live("click", function() { term.exec("help"); }); $(".clear").live("click", function() { term.exec("clear"); }); });

	$(".theme").on("change", function() { themeColors($(this).val()); term.exec("help"); });

	if (command == "help") { greetings(term); term.clear();

		$.each(menu, function(key, feed) { if ( key % 2 === 0 ) { var bold = "bold"; } else { var bold = "normal"; }

		term.echo("<tag-name style='white-space:pre'><a href='#' style='color: " + acolor + ";font-weight:" + bold +"' id='" + feed.cmd + "' class='menu'>" + feed.cmd + "</a>     &#9;&#9;<a target='_blank' style='color: " + acolor + ";font-weight:" + bold +"' href='" + feed.homepage + "'>" + feed.title + "</a><br></tag-name>", { raw : true }); });

	} else { $.each(menu, function(key, feed) { if (command === feed.cmd) { getfeed(term, feed.feed, feed.homepage); } }); }

    }, { keydown: function() { return false; }, prompt: "~ ", greetings: null, onBlur: function() { return false; }, onInit: function(term) { term.exec("help"); term.clear(); themeColors(); }, onClear: function(term) { greetings(term); } 

    });

    function greetings(term) { term.echo("<tag-name style='white-space:pre'><a target='_blank' style='color:" + acolor + ";font-weight:" + bold + "' href='https://github.com/acktic/hiwi'>hiwi</a>&#9;&#9;&#9;&#9;&#9;<a href='#' class='help' style='color:" + acolor + ";font-weight:" + bold + "'>menu</a>&#9;&#9;&#9;&#9;&#9;<a class='clear' href='#' style='color:" + acolor + ";font-weight:" + bold + "'>clear</a></tag-name><br><br>", { raw : true }); }

    function getfeed(term, feed, homepage) {

	$.get(proxy + feed, function (data) {

		var entry = $(data).find("entry")

		if ( entry.length > 0 ) { var format = "entry" } else { var format = "item" }

	        $(data).find(format).each(function (index) { term.echo("<br>", { raw : true });

			if ( format == "entry" ) { var link = $(this).find("link").attr("href") } else { var link = $(this).find("link").text(); }
							
			if ( index % 2 === 0 ) { menuBold = "bold"; } else { menuBold = "normal"; }
			
			if (index >= 20) { term.echo("<a target='_blank' style='color: " + acolor + ";font-weight:" + menuBold + "' href='" + homepage + "'>" + homepage.replace(/^(?:https?:\/\/)?/g, "") + "</a>", { raw : true }); return false;

			} else { term.echo("<a target='_blank' style='color: " + acolor + ";font-weight:" + menuBold + "' href='" + link + "'>" + $(this).find("title").text() + "</a>", { raw : true }); }

   		});

	});

    }

});

    function themeColors(theme) { 

	if (theme == "yotsuba") { acolor = "#81413B"; bcolor = "background-image: linear-gradient(#EDD6BE, #FFFAE7)"; 

	} else if (theme == "yotsubab") { acolor = "#828593"; bcolor = "background-image: linear-gradient(#D0D5E1, #E7E9F5)"; 

	} else if (theme == "solarized") { acolor = "grey"; bcolor = "background-image: linear-gradient(#012A35, #043440";

	} else if (theme == "white hat") { acolor = "green"; bcolor = "--background: white;";

	} else if (theme == "black hat") { acolor = "white"; bcolor = "--background: black;"; 

	} $("a").attr("style", "color:" + acolor); $("a").css("font-weight", bold); $("#clock").css("color", acolor); $(".terminal").attr("style", bcolor);

    }
</script>
<div id="clock"></div><script>setInterval(function(){ document.getElementById('clock').innerHTML = new Date; }, 1000);</script><select class="theme" style="position: absolute; z-index: 365; width: 7em; right: .2em; bottom: .2em;"><option>yotsuba</option><option>yotsubab</option><option>solarized</option><option>white hat</option><option>black hat</option>
</select>
</body>
</html>
