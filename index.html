<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=no">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link rel="icon" type="image/png" href="favicon/favicon.png">
    <script src="https://acktic.github.io/rss.js"></script>
  </head>
<style>
@media screen and (min-width: 960px) {

    html { background-color: rgba(38,38,38,.02) }

    body {
	transform: translate(50%,50%);
	border: 1px solid #ddd;
	position: absolute;
	bottom: 49.5%;
	border: none;
	height: 100%;
	width: 55%;
	right: 50%;
    }
}
    div { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif }

    .category:hover { color: #aaa !important }

    ::-webkit-scrollbar { display: none }

    .wrapper { height: 100% }

    .arm { font-size: 11px }

    hr { opacity: .2 }

    .container {
	position: absolute;
	height: 100%;
	width: 100%;
	left: 0em;
	top: 0em;
    }
    .attach {
	justify-content: center;
	display: flex;
	height: 1em;
	opacity: 1;
    }
    .category {
	display: inline-block;
	text-align: center;
	padding-top: 1.5em;
	font-size: 9px;
	cursor: default;
	height: 2.5em;
	width: 14%;
    }
    .output {
	-ms-overflow-style: -ms-autohiding-scrollbar;
	-webkit-overflow-scrolling: touch;
	outline: none !important;
	height: calc(100% - 90px);
	scrollbar-width: none;
	padding-right: 2.5em;
	position: relative;
	overflow-y: scroll;
	overflow: auto;
	top: 1em;
    }
    .set {
	padding-bottom: 2em;
	line-height: 1.4em;
	margin-left: 15%;
	font-size: 10px;
	cursor: default;
	height: 5em;
	width: 80%;
    }
    .end {
	border-radius: 12px;
	margin-bottom: 3.5em;
	padding-bottom: 2em;
	line-height: 1.4em;
	margin-right: auto;
	padding-right: 2em;
	padding-top: 3.5em;
	padding-left: 2em;
	text-align: left;
	margin-left: 15%;
	font-size: 10px;
	cursor: pointer;
	display: table;
	width: 70%;
    }
    .ago {
	margin-top: -.8em;
	text-align: left;
	line-height: 1em;
	font-size: 8px;
	float: left;
    }
    .icon {
	justify-content: center;
	position: relative;
	display: flex;
	top: 1.5em;
    }
    .random, .opposite {
	position: absolute;
	padding-top: 2em;
	cursor: default;
	height: 24px;
	width: 24px;
	top: -1em;
    }
    .random {
	padding-left: 2em;
	right: .3em;
    }
    .opposite {
	padding-right: 2em;
	left: .3em;
    }
    #fav, #inv {
	height: 32px;
	width: 32px;
    }
    .hed {
	text-transform: capitalize;
	letter-spacing: 1px;
	font-family: Arial;
	line-height: 1.4em;
	margin-left: auto;
	font-weight: bold;
	font-size: 13px;
    }
    .yt {
	-webkit-overflow-scrolling: touch;
	padding-bottom: 56.25%;
	position: relative;
	overflow-y: scroll;
	width: 100%;
	height: 0;
    }
    iframe {
	position: absolute;
	height: 100%;
	width: 100%;
	left: 0;
	top: 0;
    }
    .thum {
	margin-top: -1.25em;
	margin-left: auto;
	border: none;
	width: 100%;
    }
</style>
<body>
<div class='wrapper'>
<div class='container'>
	<div class='attach'>
		<div id='News' class='category'>News</div>
		<div id='Media' class='category'>Media</div>
		<div id='Social' class='category'>Social</div>
		<div id='Sport' class='category'>Sport</div>
		<div id='Technology' class='category'>Tech</div>
		<div id='World' class='category'>World</div>
		<div id='Youtube' class='category'>Youtube</div>
	</div>
	<div class='output'></div>
	<div class='icon'>
		<img id='inv' class='favicon' src='favicon/invert.png'>
		<img id='fav' class='favicon' src='favicon/favicon.png'>
		<div class='random'></div>
		<div class='opposite'></div>
	</div>
</div>
</div>
<script>
var ost = 0
var his = 0
var job = false
var tap = false
var sel = 'Social'

if (location.href.match('\\?op=0') || location.href.match('\\?op=1')){

        app(location.search.split('?op=')[1])

}

else {

        app('0')

}

pop(sel)
scr('.pop')
$('#'+sel).css('color','#aaa')

$('.output').attr('tabindex', -1).focus()

$('.output').focusout(function(){

	setTimeout(function(){ $('.output').focus() }, 100)

})

$('.attach').on('mouseenter', function() {

	$(this).css('opacity','1')

})

$('.random').on('touchstart click', function(e) {

	ran(sel)

    e.preventDefault()

})

$('.opposite').on('touchstart click', function(e) {

	app('op')

    e.preventDefault()

})

$('.category').on('touchstart click', function(e){

	$('.category').css('color','#373737')
	$(this).css('color','#aaa')
	pop($(this).attr('id'))
	scr('.pop:last')

    e.preventDefault()

})

$('.output').on('scroll', function(e){

	if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight - 1)
		if (job == false)
			pop(sel)
			pin($(this).scrollTop())

})

$('.favicon').on('touchstart click', function(e){

	tap = null
	pop(sel)
	scr('.pop:last')

    e.preventDefault()

})

function scr(n){

	$('.output').animate({
		scrollTop: $(n+':last').offset().top - $('.output').offset().top + $('.output').scrollTop()
	}, 300)

}

function pin(n){

	if (n <= 0 && job == false) air(sel)
	else if (n < ost && n != 0) $('.attach').css('opacity','1')
	else if (n > ost && n > 50) $('.attach').css('opacity','0')

    ost = n

}

function ran(n){

	var obj = []
	$.each(menu, function(i,k){ if (n == k.cat) obj.push(menu[i]) })
	var n = obj[Math.floor(Math.random()*obj.length)]
	get(menu.indexOf(n))

}

function rev(n) {

	var newn = {}
	var keys = []
	for (var key in n) {
		keys.push(key)
	}
	for (var i = keys.length - 1; i >= 0; i--) {
		var value = n[keys[i]]
		newn[keys[i]] = value
	}

   return newn

}

function utc(n){

	var opt = { weekday:'short',day:'2-digit',month:'short',year:'numeric',hour:'numeric',minute:'numeric',second:'2-digit',hour12:true }
	var dmz = []
	dmz.push(ago(n))
	var utc = new Date(n)
	var gmt = utc.toLocaleString('en-US', opt)
	dmz.push(gmt)

    return dmz

}

function ago(n){

	var age = new Date()
	var dis=age.getTime() - new Date(n).getTime()
	var sec=dis/1000
	if(sec<60) return parseInt(sec)+' second'+(parseInt(sec)>1?'s':'')+' ago'
	var min=sec/60; if(min<60) return parseInt(min)+' minute'+(parseInt(min)>1?'s':'')+' ago'
	var h=min/60; if(h<24) return parseInt(h)+' hour'+(parseInt(h)>1?'s':'')+' ago'
	var d=h/24; if(d<30) return parseInt(d)+' day'+(parseInt(d)>1?'s':'')+' ago'
	var m=d/30; if(m<12) return parseInt(m)+' month'+(parseInt(m)>1?'s':'')+' ago'
	var y=m/121;

    return parseInt(y)+' year'+(parseInt(y)>1?'s':'')+' ago'

}

function app(n){

	if (n == 'op'){ op = op != true }
	else if (n == 1 || n == 0) op = n

	if (op == 1){
		$('html, .container, .output').css({'background-color':'#000','color':'#EFEFEF'})
		$('#fav').css({'display':'block'}); $('#inv').hide(); $('hr').hide()
	}
	else if (op == 0){
		$('.container, .output').css({'background-color': '#fff','color':'#373737'})
		$('html').css('background-color','rgba(38,38,38,.02)')
		$('#inv').css({'display':'block'}); $('#fav').hide(); $('hr').show()
	}

}

function air(n){

	rev(menu.reverse())
	$('.output').prepend("<div class='air'></div>")
	for (var i = menu.reverse().length - 1; i >= 0; i--){
		if (n == menu[i].cat)
			$('.air').prepend("<div class='set "+i+"' onclick='get(\""+i+"\")'><hr>"+menu[i].des+"</div>")
	}
	$('.output').scrollTop($('.output').scrollTop() + $('.air:first').outerHeight())
	app()

}

function pop(n){

	document.title = n + ' ack'
	if (n != sel) his = 0
	sel = n
	$('.output').append("<div class='pop'></div>")
	for (var i = his; i < menu.length; i++){
		if (n == menu[i].cat)
			$('.pop').append("<div class='set "+i+"' onclick='get(\""+i+"\")'><hr>"+menu[i].des+"</div>")
	}

	his = 0
	app()

}

function get(n){
	var e = 0
	job = true
	var obj = []
	var quit = 10
	if (sel == 'Youtube'){ var let = 250 } else { var let = 0 }
	$.each(menu, function(i,k){ if (sel == k.cat) obj.push(menu[i]) })
	if (obj.indexOf(menu[n]) == obj.lastIndexOflength - 1) his = 0
	else his = parseInt(n) + 1
	$('.attach').css('opacity','0')
	$('.pop, .air, .get').remove()
	$('.output').append("<div class='arm' style='text-align:center;margin-right:.3em'>"+e+"</div><div class='get'></div>")
	var int = setInterval(function(){ e = e + 1; $('.arm').html(e) }, 1000)
	$.get('https://salty-refuge-64158.herokuapp.com/' + menu[n].uri)
		.fail(function(){    clearInterval(int); $('.arm').remove(); job = false; pop(sel) })
		.done(function(data){clearInterval(int)
			$('.arm').remove()
			if ($(data).find('entry').length > 0)				     var chn = "entry"
			else 								     var chn = 'item'
				$(data).find(chn).each(function(i){
				    $(this).delay(i*let).queue(function(){ 
					if (chn == 'entry'){
											     var ref = $(this).find('link').attr('href')
											     var dst = utc($(this).find('updated').text())
					}
					else {
											     var ref = $(this).find('link').text()
						if ($(this).find('pubDate').text().length>0) var dst = utc($(this).find('pubDate').text())
											else var dst = utc($(this).find('dc\\:date, date').text())
					}						/* Reddit thumbnails */
											    if (thum = $(this).find('content').text()){
												thum = thum.match(/https:\/\/.\.thumbs\.redditmedia\.com\/.+?(png|jpg)/g)
									       if (thum != null)thum = "<img src='"+thum+"' style='height:50%;width:55%'><br>"
									       else		thum = ''
											}
											/* Youtube thumbnails */
										        else if (thum= $(this).find('link').attr('href')){
								  if (thum.match(/youtube/)){   thum = "<div class='yt'><iframe src='https://www.youtube.com/embed/"+thum.split('=')[1]+"' frameborder='0' allowfullscreen></iframe></div><br>" +
												       "<div class='ago'><b>Views</b> "+$(this).find('media\\:statistics, statistics').attr('views').replace(/\B(?=(\d{3})+(?!\d))/g, ",") + "</div><br>"
											/* Standard thumbnails */
											    }
											   else thum = "<img src='"+thum+"'><br>"
											} /*  Media Thumbnails */
											else if (thum= $(this).find('media\\:thumbnail, thumbnail').attr('url')){
												thum = "<img src='"+thum+"' style='width:100%'><br>"
											}
											/* Description thumbnails */
											else if(thum = $(this).find('description').text()){
											     if(thum = thum.match(/[a-z\-_0-9\/\:\.]*s\.jpg/))
												thum = "<img src='"+thum+"' style='height:50%;width:55%'><br>"
											   else thum = ''
											}
											/* Empty invalid */
											else 	thum = ''
					var pub = "<div class='end' onclick='window.open(\""+ref+"\")'><div class='hed'>"+$(this).find('title:first').text().substring(0,75)+'...'+"</div>" +
							 "<br><div class='thum'>"+thum+"</div><div class='ago'><br><b>"+dst[0]+"</b> "+dst[1]+"</div><br></div>"
					if (i >= quit){ app(); return false }
					if (i < quit) $('.get').append(pub)
				    })
				})
			job = false
		})
}
</script>
</body>
</html>
