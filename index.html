<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=no">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
    <link rel="icon" type="image/png" href="favicon/favicon.png">
    <script src="https://acktic.github.io/rss.js"></script>
  </head>
<style>
@media only screen and (min-width: 960px) {
    body {
	transform: translate(50%,50%);
    	position: fixed;
	border: none;
	bottom: 50%;
	height: 100%;
	width: 65%;
	right: 50%;
    }
    a:hover {
	text-decoration: underline;
	cursor: pointer;
	color: #111;
    }
}
    ::-webkit-scrollbar {
	display: none;
    }
    a {
	padding-right: 3em;
    }
    div {
	font-family: 'Roboto', sans-serif;;
	font-size: 12px;
	cursor: default;
    }
    .con {
	position: absolute;
	height: 100%;
	width: 100%;
	left: 0em;
	top: 0em;
    }
    .tag {
	justify-content: center;
	display: flex;
	height: 3.5em;
    }
    .cat {
	display: inline-block;
	padding-bottom: 2em;
	padding-top: 1.3em;
	text-align: center;
	font-size: 12px;
	cursor: pointer;
	width: 16.3%;
    }
    .out {
	-ms-overflow-style: -ms-autohiding-scrollbar;	
	border-bottom: 1px solid #AAA;
	outline: none !important;
	scrollbar-width: none;
	overflow-y: scroll;
	overflow: auto;
	height: 88%;
    }
    .xml {
	padding-bottom: 2em;
	padding-right: 1em;
	line-height: 1.2em;
	padding-left: 1.5em;
	padding-top: 2em;
    }
    .clr {
	border-radius: 16px;
	width: fit-content;
	padding-right: 1em;
	line-height: 1.6em;
	margin-bottom: 1em;
	margin-right: .5em;
	padding-left: 1em;
	margin-left: auto;
	display: table;
    }
    .ago {
	line-height: 1.2em;
	font-size: 9px;
	text-align: right;
    }
    .favicon {
	justify-content: center;
	display: flex;
    }
    .inv, .fav {
	box-shadow: 1px 1px 3px #AAA;
	border-radius: 24px;
	height: 40px;
	width: 40px;
    }
</style>
<body>
    <div class="con">
	<div class="tag">
		<div id="News" class="cat" onclick="pop('News')">News</div>
		<div id="Media" class="cat" onclick="pop('Media')">Media</div>
		<div id="Social" class="cat" onclick="pop('Social')">Social</div>
		<div id="Sport" class="cat" onclick="pop('Sport')">Sport</div>
		<div id="Technology" class="cat" onclick="pop('Technology')">Tech</div>
		<div id="World" class="cat" onclick="pop('World')">World</div>
	</div>
	<div class="out"></div>
	<div class="favicon"><img class="inv" src="favicon/invert.png"><img class="fav" src="favicon/favicon.png"></div>
    </div>
<script>
var old = null
var opp = false
var tap = false
var rss = false
var sel = 'Social'
    if (location.href.match('\\?opp=0')) app(false)
    if (location.href.match('\\?opp=1')) app(true)
    if (location.href.match('\\&category=News') ||
	location.href.match('\\&category=Media') ||
	location.href.match('\\&category=Social') ||
	location.href.match('\\&category=Sport') ||
	location.href.match('\\&category=Technology') ||
	location.href.match('\\&category=World')) pop(location.search.split('&category=')[1])
    else {
	pop(sel)
	app(opp)
    }
$('.out').attr('tabindex',-1).focus();
$('.out').focusout(function(){ setTimeout(function(){ $('.out').focus() },100) })
$('.cat').hover(function(){ $(this).css('color','#AAA')}).mouseout(function(){ $(this).css('color','inherit') })
$('.out').on('scroll',function(){ if ($(this).scrollTop()+$(this).innerHeight() >= $(this)[0].scrollHeight) if (rss == false) pop(sel) })
$('.inv, .fav').on('touchstart click', function(e){
	if (!tap){
		tap=setTimeout(function(){
			tap = null
			old = null
			pop(sel)
		},250)
	}
  	else {
		clearTimeout(tap)
			tap=null
			app('opp')
	}
    e.preventDefault()
})
function url(n){ window.open(n) }
function xhr(n){ old = n; get(menu[n].cat, menu[n].des, menu[n].uri, menu[n].ext) }
function scr(n){ $('.out').animate({ scrollTop:$(n+':last').offset().top - $('.out').offset().top + $('.out').scrollTop()}, 300) }
function utc(n){
	var dmz = []
	dmz.push(ago(n))
	var utc = new Date(n)
	var opt = { weekday: 'short', day: '2-digit', month: 'short', year: 'numeric', hour: 'numeric', minute: 'numeric', second: '2-digit', hour12: true }
	var gmt = utc.toLocaleString('en-US', opt);
	dmz.push(gmt)
     return dmz
}   
function ago(n){
	var dat = new Date()
	var dif=dat.getTime() - new Date(n).getTime()
	var sec=dif/1000; if(sec<60) return parseInt(sec)+' second'+(parseInt(sec)>1?'s':'')+' ago'
	var min=sec/60; if(min<60) return parseInt(min)+' minute'+(parseInt(min)>1?'s':'')+' ago';
	var h=min/60; if(h<24) return parseInt(h)+' hour'+(parseInt(h)>1?'s':'')+' ago';
	var d=h/24; if(d<30) return parseInt(d)+' day'+(parseInt(d)>1?'s':'')+' ago';
	var m=d/30; if(m<12) return parseInt(m)+' month'+(parseInt(m)>1?'s':'')+' ago';
	var y=m/121; return parseInt(y)+' year'+(parseInt(y)>1?'s':'')+' ago';
}
function pop(n){
	if (n != sel) old = null
	sel = n
	var lst = []
	$('.pop, .bar').remove()
	$(document).attr('title',n+' - ack')
	$('.out').append("<div class='bar' style='padding-top:" + $('.out').height()/100*.35+"em'></div>" +
			 "<div class='pop' style='padding-top:.5em'></div>")
	$.each(menu, function(i, k){
		if (n == k.cat){
			lst.push(i)
			$('.pop').append("<div class='xml "+i+"' style='width:fit-content' onclick='xhr("+i+")'><b>"+k.cat+"</b>&ensp;<a>"+k.des+"</a></div>")
		}
	})
	$('.out').append("<div class='bar' style='padding-bottom:"+$(".out").height()*.025+"em'></div>")
	if (old!=null && lst.indexOf(old) <= lst.length  - lst.length * .25) scr('.'+old)
	else scr('.pop:last')
}
function app(n){
	if (n == 'opp') opp = opp != true
	else if (n == true || n == false) opp = n
	if (opp == true){
		$('body, .con, .out, .tag, .clr').css({'background-color':'#000','border':'none','color':'#EFEFEF'})
		$('.clr, .fav, .inv').css('box-shadow','0px 0px 0px #000')
		$('.fav').css('display','block')
		$('.inv').css('display','none')
	}
	else if (opp == false){
		$('body, .con').css({'background-color':'#F5F5F5','color':'#373737'})
		$('.out').css({'border-bottom':'1px solid #AAA','background-color':'#FAFAFA','color':'#373737'})
		$('.tag').css({'background-color': '#373737','color':'#EAEAEA'})
		$('.clr').css({'background-color':'#FAFAFA','color':'#373737'})
		$('.clr, .fav, .inv').css('box-shadow','1px 1px 3px #AAA')
		$('.inv').css('display','block')
		$('.fav').css('display','none')
	}
}
function get(cat, des, uri, ext){
	rss = true
	$('.bar').remove();
	$('.out').append("<div class='bar'><br>&ensp;&ensp;It's on the way!&ensp;Please be patient.</div><br><br><div class='get'>")
	var int = setInterval(function() { $(".bar").append(".") }, 1000);
	scr('.get:last')
	$.get('https://salty-refuge-64158.herokuapp.com/'+uri)
		.fail(function(){
			$('.out').append("<div class='get'><div class='xml'> &ensp;Oops! Something went wrong!</div></div></div>")
			clearInterval(int)
			rss = false
		})
		.success(function(req){
			clearInterval(int)
			$('.bar').remove()
			$('.out').append("<div class='xml' onclick='url(\""+ext+"\")'><a><b>"+cat+"</b>&ensp;"+des+"</a></div></div>")
			if ($(req).find('entry').length > 0) var set = "entry"
			else 				     var set = 'item'
				$(req).find(set).each(function(i, k){
					if (i >= 19) return false
					if (set == 'entry'){ var ref = $(this).find('link').attr('href')
							     var pdt = utc($(this).find('updated').text())
					}
					else {		     var ref = $(this).find('link').text()
		if ($(this).find('pubDate').text().length>0) var pdt = utc($(this).find('pubDate').text())
							else var pdt = utc($(this).find("dc\:date").text())
					}
		$('.out').append("<div class='pad' style='margin:1.5em'><div class='xml clr' onclick='url(\""+ref+"\")'>&ensp;<a>"+$(this).find("title").text()+"...</a>" +
				 "<div class='ago'>"+pdt[0]+"<br>"+pdt[1]+"</div></div></div>")
		})
		$('.out').append("<div class='xml' onclick='url(\""+ext+"\")'><a><b>"+cat+"</b>&ensp;"+des+"</a></div><br><br><hr>" +
				 "<div class='bar' style='padding-bottom:"+$(".out").height()*.025+"em'></div>")
		scr('.get:last')
		rss = false
		app(opp)
		})
}
</script>
</body>
</html>
