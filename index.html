<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0,user-scalable=no">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script src="https://acktic.github.io/rss.js"></script>
    <link rel="icon" type="image/png" href="favicon.png">
  </head>
<body>
<style>
	::-webkit-scrollbar {
		display: none
	}
	div {
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
		font-family: 'Roboto', sans-serif;;
		font-size: 12px;
		cursor: default;
	}
	.con {
		border-bottom: 1px solid #f9f9f9;
		position: absolute;
		height: 99%;
		width: 96%;
		top: -.5em;
	}
	.cat {
		font-family: 'Roboto', sans-serif;;
		display: inline-block;
		padding-bottom: 2em;
		padding-top: 2em;
		text-align: center;
		font-size: 14px;
		width: 16.3%;
	}
	.out {
		webkit-overflow-scrolling: touch;
		outline: none !important;
		position: absolute;
		overflow: auto;
		bottom: 3em;
		width: 100%;
	}
	.xml {
		padding-bottom: 2em;
		padding-left: 1em;
		padding-top: 1em;
		line-height: 1.2em;
		width: fit-content;
	}
	.fav {
		transform: translateX(50%);
		position: absolute;
		bottom: -1em;
		height: 30px;
		width: 30px;
		right: 50%;
		border-radius: 26px;
	}
</style>
    <div class="con">
	<div class="tag" style="justify-content:center;display:flex;height:4.5em;width:100%">
		<div id="Local" class="cat" onclick="pop('Local')">Local</div>
		<div id="Style" class="cat" onclick="pop('Style')">Style</div>
		<div id="Social" class="cat" onclick="pop('Social')">Social</div>
		<div id="Sports" class="cat" onclick="pop('Sports')">Sports</div>
		<div id="Technology" class="cat" onclick="pop('Technology')">Tech</div>
		<div id="World" class="cat" onclick="pop('World')">World</div>
	</div>
		<img class="fav" src="https://acktic.github.io/favicon.png">
	<div class="out"><div>
    </div>
<script>
var bar = 3
var obj = []
var tap = false
var rss = false
var dark = false
var sel = "Local"
	$(document).one("ready", function() {
		pop(sel)
		$(".out").css("top", $(".tag").height() + 2 + "px");
		if ( location.href.match('\\?dark=0') ) app(false)
		if ( location.href.match('\\?dark=1') ) app(true)
		if ( location.href.match('\\&cat=Local') ) pop("Local")
 		if ( location.href.match('\\&cat=Entertainment') ) pop("Style")
		if ( location.href.match('\\&cat=Social') ) pop("Social")
		if ( location.href.match('\\&cat=Sports') ) pop("Sports")
		if ( location.href.match('\\&cat=Technology') ) pop("Technology")
		if ( location.href.match('\\&cat=World') ) pop("World")
		$(".out").attr('tabindex', -1).focus();
		$(".out").focusout(function(){ $(".out").attr('tabindex', -1).focus() })
   		$('.out').on('scroll', function(){
			if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight ) {
				if (rss == false) pop(sel)
			}
			if ($(this).scrollTop() < 1) scr(".pop")
		})
		$(".fav").on("touchstart click",function(e){
			if(!tap){
				tap = setTimeout(function(){
					tap = null
					pop(sel)
				},200)
			}
			else {
				clearTimeout(tap)
				tap = null
				ran(sel)
			}
		    e.preventDefault()
		});
	});
	function url(n) { window.open(n); };
	function xhr(n) { $.each(menu, function(i, k) { if (n == k.name) get(k.category, k.feed, k.title, k.homepage); }) }
	function scr(n) { $(".out").animate({ scrollTop: $(n + ":last").offset().top - $(".out").offset().top + $(".out").scrollTop() }, 200) }
	function ran(n) {
		$.each(menu, function(i, k) { if (n == k.category) obj.push(menu[i]) })
		var n = obj[Math.floor(Math.random()*obj.length)]
		get(n.category, n.feed, n.title, n.homepage)
	}
	function app(n) {
		if (n == true || n == false) dark = n
		if (n == "toggle") dark = dark != true
		if (dark == false) $("body, .con, .cat, .xml").css({"background-color":"transparent","color":"#000000"})
		else if (dark == true) $("body, .con, .cat, .xml").css({"background-color":"#000000","color":"#FFFFFF"})
	}
	function pop(n) {
		sel = n
		$(document).attr("title", n + " - ack")
		$(".pop, .xml, .bar").remove()
		$('.out').append("<div class='bar' style='padding-top:" + $(".out").height() / 100 * bar + "em' onclick='app(\"toggle\")'></div><div class='pop'>")
		scr(".pop")
		$.each(menu, function(i, k) {
			if (n == k.category) $(".out").append("<div id='" + k.name + "' class='xml' onclick='xhr($(this).attr(\"id\"))'><b>&ensp;&ensp;" + k.category + "</b>&ensp;" + k.title + "</div>") })
		$('.out').append("<div class='bar' style='padding-bottom:" + $(".out").height() / 100 * bar + "em'></div></div>")
		app()
	}
	function get(category, feed, title, homepage) {
		rss = true
		$(".pop, .bar").remove()
		$(".out").append("<div class='get'><div class='xml'>&ensp;&ensp;It's on the way!&ensp;&ensp;Please be patient.</div></div>")
		scr(".get:last")
		$.get("https://salty-refuge-64158.herokuapp.com/" + feed)
		.fail(function() { $(".out").append("<div class='get'><div class='xml'><div class='xml'>&ensp;&ensp;Oops! Something went wrong!</div></div>"); })
		.success(function (data) {
			var entry = $(data).find("entry")
			if (entry.length > 0) var format = "entry"
			else var format = "item"
			$(".out").append("<div class='get'><div class='xml' onclick='url(\"" + homepage + "\")'>&ensp;&ensp;<b>" + category + "</b>&ensp;" + title + "</div>")
			$(data).find(format).each(function (i, k) {
				if (format == "entry") {
					var link = $(this).find("link").attr("href")
					var date = $(this).find("updated").text()
				}
				else {
					var link = $(this).find("link").text();
					var date = $(this).find("pubDate").text()
				}
				$(".out").append("<div class='xml' onclick='url(\"" + link + "\")'>&ensp;&ensp;" + $(this).find("title").text() + "<br>&ensp;&ensp;" + date + "</div>");
				if(i >= 24) return false
			});
			rss = false
			$(".out").append("<div class='xml' onclick='url(\"" + homepage + "\")'>&ensp;&ensp;<b>" + category + "</b>&ensp;" + title + "</div>")
			$('.out').append("<div class='bar' onclick='app(\"toggle\")' style='padding-bottom:" + $(".out").height() / 100 * bar + "em'></div>")
			app()
			scr(".get")
		})
	}
</script>
</body>
</html>
