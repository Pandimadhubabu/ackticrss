<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>hiwi</title>
    <link rel="shortcut icon" href="favicon.ico">
    <script src="rssfeeds.js"></script>
    <script src="jquery-1.7.1.min.js"></script>
    <script src="jquery.mousewheel-min.js"></script>
    <script src="jquery.terminal.min.js"></script>
    <link href="jquery.terminal.min.css" rel="stylesheet"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
<body>
<style>
	@import url('https://fonts.googleapis.com/css?family=Space+Mono&display=swap');

	a { text-decoration: none; letter-spacing: .5px; }

	#clock { cursor: pointer; position: absolute; z-index: 365; top: 10px; right: 5px; font-size: 10px; font-family: 'Space Mono', monospace; }

	.cmd, span { visibility: hidden; }

	.terminal, .cmd { --size: .9; font-family: 'Space Mono', monospace }

	::-webkit-scrollbar { display: none; }
</style>
<script>
var bold

var proxy = "https://cors-anywhere.herokuapp.com/";

jQuery(function($) {

    $(".theme").val("yotsuba"); invertColor("yotsuba");

    $("body").terminal(function(command, term) {

	$(document).one('ready', function() {

		$("#clock").live("click", function() { window.open('http://time.is', '_blank'); });

		$(".menu").live("click", function(event) { term.exec(event.target.id); term.clear(); });

		$(".help").live("click", function() { term.exec("help"); });

	});

	if (command == "help") {

		greetings(term);

		term.clear();

		$.each(menu, function(key, feed) { if ( key % 2 === 0 ) { bold = "bold"; } else { bold = "normal"; }

		term.echo("<tag-name style='white-space:pre'><a href='#' style='color: " + acolor + ";font-weight:" + bold +"' id='" + feed.cmd + "' class='menu'>" + feed.cmd + "</a>     &#9;&#9;<a target='_blank' style='color: " + acolor + ";font-weight:" + bold +"' href='" + feed.homepage + "'>" + feed.title + "</a><br></tag-name>", { raw : true }); });

		return false;

	} else {

	 	$.each(menu, function(key, feed) {

			if (command === feed.cmd) {
			
				homepage = feed.homepage

				url = feed.feed

				getfeed(term, url, homepage);

			}

		});

        }

    }, { prompt: "~ ", greetings: null, onBlur: function() { return false; }, onInit: function(term) { term.exec("help"); term.clear(); invertColor(); }, onClear: function(term) { greetings(term); } 

    });

    function greetings(term) { term.echo("<tag-name style='white-space:pre'><a target='_blank' style='color:" + acolor + ";font-weight:" + bold + "' href='https://github.com/acktic/hiwi'>hiwi</a>&#9;&#9;&#9;&#9;&#9;<a href='#' class='help' style='color:" + acolor + ";font-weight:" + bold + "'>menu</a></tag-name><br><br>", { raw : true }); }

    function getfeed(term, feed, homepage) {

	$.get(proxy + feed, function (data) {

		var entry = $(data).find("entry")

		if ( entry.length > 0 ) { var format = "entry" } else { var format = "item" }

	        $(data).find(format).each(function (index) {

			if ( format == "entry" ) { var link = $(this).find("link").attr("href") } else { var link = $(this).find("link").text(); }
							
			if ( index % 2 === 0 ) { bold = "bold"; } else { bold = "normal"; }
			
                        term.echo("<br>", { raw : true });

				if (index >= 20) { term.echo("<a target='_blank' style='color: " + acolor + ";font-weight:" + bold + "' href='" + homepage + "'>" + homepage.replace(/^(?:https?:\/\/)?/g, "") + "</a>", { raw : true }); return false;

				} else { term.echo("<a target='_blank' style='color: " + acolor + ";font-weight:" + bold + "' href='" + link + "'>" + $(this).find("title").text() + "</a>", { raw : true }); }

   		});

	});

    }

    setInterval(function(){ document.getElementById('clock').innerHTML = new Date; }, 1);

});

    function invertColor(theme) { 

	if (theme == "white hat") { acolor = "green"; bcolor = "--background: white;";

	} else if (theme == "black hat") { acolor = "white"; bcolor = "--background: black;"; 

	} else if (theme == "yotsuba") { acolor = "#81413B"; bcolor = "background-image: linear-gradient(#EDD6BE, #FFFAE7)"; 

	} else if (theme == "yotsuba b") { acolor = "#828593"; bcolor = "background-image: linear-gradient(#D0D5E1, #E7E9F5)"; 

	} else if (theme == "solarized") { acolor = "grey"; bcolor = "background-image: linear-gradient(#012A35, #043440";

	}

	$("a").attr("style", "color:" + acolor);

	$("a").css("font-weight", bold);
	
	$("#clock").css("color", acolor);

	$(".terminal").attr("style", bcolor);

	return false;

    }

</script>
<div id="clock"></div>
<select class="theme" style="position: absolute; z-index: 365; width: 100px; right: 2px; bottom: 2px;" onchange="invertColor($(this).val())">
	<option>yotsuba</option><option>yotsuba b</option><option>solarized</option><option>white hat</option><option>black hat</option>
</select>
</body>
</html>
